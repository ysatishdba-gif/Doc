# %% Test nx.ancestors on your CUIs
import networkx as nx
import re

# Find real CUI nodes
real_cuis = [n for n in list(obj.nodes())[:500_000]
             if isinstance(n, str) 
             and re.match(r'^C\d{5,}$', n)]

print(f"Real CUI nodes found: {len(real_cuis)}")

# Pick a few known medical CUIs to test
test_cuis = real_cuis[:5]
cui_set = set(real_cuis)

for cui in test_cuis:
    # Direct connections
    parents = list(obj.predecessors(cui))
    children = list(obj.successors(cui))
    
    # Full ancestor/descendant chain
    ancestors = nx.ancestors(obj, cui)
    descendants = nx.descendants(obj, cui)
    
    # Which ancestors/descendants are real CUIs?
    anc_cuis = [a for a in ancestors if a in cui_set]
    desc_cuis = [d for d in descendants if d in cui_set]
    
    print(f"\n{cui}:")
    print(f"  Direct parents:    {parents[:5]}")
    print(f"  Direct children:   {children[:5]}")
    print(f"  All ancestors:     {len(ancestors)} (CUIs: {len(anc_cuis)})")
    print(f"  All descendants:   {len(descendants)} (CUIs: {len(desc_cuis)})")
    if anc_cuis:
        print(f"  Ancestor CUIs:     {anc_cuis[:5]}")
    if desc_cuis:
        print(f"  Descendant CUIs:   {desc_cuis[:5]}")
