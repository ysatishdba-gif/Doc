# %% Check: do context entries bridge between CUIs?
import re

cui_pattern = re.compile(r'^C\d{5,}$')
real_cuis = set(n for n in obj.nodes() if isinstance(n, str) and cui_pattern.match(n))

# Pick a CUI with many descendants
test_cui = "C1140091"  # had 1512 descendants

descendants = nx.descendants(obj, test_cui)
print(f"{test_cui} has {len(descendants)} descendants")

# What do the descendants connect to?
bridges_to_other_cui = set()
for desc in descendants:
    for child in obj.successors(desc):
        # Does this child belong to a DIFFERENT CUI?
        if child in real_cuis and child != test_cui:
            bridges_to_other_cui.add(child)
        # Or is it a suffix of a different CUI?
        if isinstance(child, str) and '-' in child:
            base = child.rsplit('-', 1)[0]
            if base in real_cuis and base != test_cui:
                bridges_to_other_cui.add(base)

print(f"Bridges to other CUIs: {len(bridges_to_other_cui)}")
if bridges_to_other_cui:
    print(f"Sample: {list(bridges_to_other_cui)[:10]}")

# Also: what types of nodes are the descendants?
sample_desc = list(descendants)[:20]
print(f"\nSample descendants:")
for d in sample_desc:
    children = list(obj.successors(d))[:3]
    print(f"  {d} â†’ {children}")
